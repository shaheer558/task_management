<div class="p-6">
    <button (click)="navigateBack()" class="text-slate-500 mb-4 p-2">
        <svg xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 512 512" class = "w-5 h-5"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
            <path
                d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 288 480 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-370.7 0 73.4-73.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-128 128z" />
        </svg>
    </button>
    <h2 class="text-3xl font-bold mb-4 text-center">Add New Task</h2>

    <form (ngSubmit)="addTask(taskForm)" #taskForm="ngForm">
        <div class="mb-4">
            <label for="title" class="block text-sm font-medium">Title</label>
            <input type="text" id="title" [(ngModel)]="newTask.title" name="title" required
                class="mt-1 border border-slate-400 outline-slate-500 p-2 rounded w-full" />
            <div *ngIf="taskForm.submitted && taskForm.controls['title']?.invalid" class="text-red-500 text-sm mt-1">
                Title is required.
            </div>
        </div>

        <div class="mb-4">
            <label for="description" class="block text-sm font-medium">Description</label>
            <textarea id="description" [(ngModel)]="newTask.description" name="description" required
                class="mt-1 border border-slate-400 outline-slate-500 p-2 rounded w-full"></textarea>
            <div *ngIf="taskForm.submitted && taskForm.controls['description']?.invalid"
                class="text-red-500 text-sm mt-1">
                Description is required.
            </div>
        </div>

        <div class="mb-4">
            <label for="estimatedHours" class="block text-sm font-medium">Estimated Hours</label>
            <input type="number" id="estimatedHours" [(ngModel)]="newTask.estimatedHours" name="estimatedHours" required
                min="0" class="mt-1 border border-slate-400 outline-slate-500 p-2 rounded w-full" />
            <div *ngIf="taskForm.submitted && taskForm.controls['estimatedHours']?.invalid"
                class="text-red-500 text-sm mt-1">
                Estimated Hours is required and must be a positive number.
            </div>
        </div>

        <!-- priority field -->
        <div class="mb-4">
            <label for="priority" class="block text-sm font-medium">Priority</label>
            <select id="priority" [(ngModel)]="newTask.priority" name="priority" required
                class="mt-1 border border-slate-400 outline-slate-500 p-2 rounded w-full">
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
            </select>
            <div *ngIf="taskForm.submitted && taskForm.controls['priority']?.invalid"
                class="text-red-500 text-sm mt-1">
                Priority is required.
            </div>
        </div>

        <div class="mb-4">
            <label for="assignedTo" class="block text-sm font-medium">Assigned To ({{ searchType | titlecase }})</label>
            <div class="flex items-center">
                <input type="text" id="assignedTo" [(ngModel)]="searchQuery" name="assignedTo" required
                    (input)="searchUsers(searchQuery)"
                    class="mt-1 border border-slate-400 outline-slate-500 p-2 rounded w-2/3 mr-2" />
                <select id="searchType" [(ngModel)]="searchType" name="searchType"
                    class="mt-1 border border-slate-400 outline-slate-500 p-2 rounded w-1/3">
                    <option value="name">Name</option>
                    <option value="email">Email</option>
                </select>
            </div>
            <div *ngIf="taskForm.submitted && taskForm.controls['assignedTo']?.invalid"
                class="text-red-500 text-sm mt-1">
                Assigned To is required.
            </div>
            <ul *ngIf="userSuggestions.length" class="border border-gray-300 rounded mt-1 bg-white">
                <li *ngFor="let user of userSuggestions" (click)="selectUser(user)"
                    class="p-2 cursor-pointer hover:bg-gray-100">
                    {{ user.name }} ({{ user.email }})
                </li>
            </ul>
        </div>

        <button type="submit" [disabled]="taskForm.invalid" 
                [ngClass]="taskForm.invalid ? 'bg-gray-400' : 'bg-blue-500'" 
                class="text-white p-2 rounded">
            Add Task
        </button>  
    </form>
</div>

<!-- display error message -->
<div *ngIf="errorMessage" [ngClass]="messageVisible ? 'fade-in' : 'fade-out'"
    class="fixed top-10 inset-x-0 mx-auto px-3 py-2 text-white bg-red-500 rounded w-4/5 text-center">
    {{ errorMessage }}
</div>
<!-- display success message -->
<div *ngIf="successMessage" [ngClass]="messageVisible ? 'fade-in' : 'fade-out'"
    class="fixed top-10 inset-x-0 mx-auto px-3 py-2 text-white bg-green-500 rounded w-4/5 text-center">
    {{ successMessage }}
</div>